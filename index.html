<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Potty Mouth - Insult Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Russo+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Russo One', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0d0d1a 0%, #1a1a2e 30%, #16213e 60%, #0f3460 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow-x: hidden;
            overflow-y: auto;
            padding: 20px 10px;
            -webkit-tap-highlight-color: transparent;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 200, 0, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
        }

        /* Fullscreen optimizations */
        body:fullscreen {
            padding: 40px;
        }

        body:fullscreen h1 {
            font-size: 5rem;
        }

        body:fullscreen .slot-machine {
            transform: scale(1.3);
        }

        h1 {
            font-family: 'Bangers', cursive;
            font-size: clamp(2rem, 8vw, 4rem);
            margin-bottom: 0.3rem;
            letter-spacing: 4px;
            background: linear-gradient(180deg, #ff6b6b 0%, #ff8e53 50%, #ffd93d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5))
                    drop-shadow(0 0 30px rgba(255, 107, 107, 0.3));
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5)) drop-shadow(0 0 30px rgba(255, 107, 107, 0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.8)) drop-shadow(0 0 50px rgba(255, 107, 107, 0.5)); }
        }

        .subtitle {
            color: #4ecdc4;
            margin-bottom: 1.5rem;
            font-size: clamp(0.8rem, 3vw, 1.1rem);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        .fullscreen-hint {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fullscreen-hint:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        body:fullscreen .fullscreen-hint {
            display: none;
        }

        /* Quality control */
        .quality-control {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 12px 15px;
            border-radius: 15px;
            font-size: 0.75rem;
            color: #aaa;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .quality-control label {
            display: block;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.65rem;
            color: #4ecdc4;
        }

        .quality-slider {
            width: 100px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #374151, #fbbf24, #f59e0b);
            border-radius: 4px;
            cursor: pointer;
        }

        .quality-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(180deg, #fff, #ddd);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        .quality-value {
            text-align: center;
            margin-top: 8px;
            font-weight: bold;
            color: #fbbf24;
            font-size: 0.8rem;
        }

        /* Trash button */
        .trash-btn {
            display: none;
            margin-left: 10px;
            padding: clamp(10px, 3vw, 15px) clamp(15px, 4vw, 20px);
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: white;
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow:
                0 4px 0 #b91c1c,
                0 6px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            vertical-align: top;
        }

        .trash-btn.show {
            display: inline-block;
        }

        .trash-btn:hover {
            background: linear-gradient(180deg, #f87171 0%, #ef4444 100%);
            transform: scale(1.05);
        }

        .trash-btn:active {
            transform: translateY(3px) scale(1.02);
        }

        .trash-btn.trashed {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            box-shadow: 0 2px 0 #374151;
        }

        /* Review counter */
        .review-counter {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(239, 68, 68, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            color: #f87171;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(239, 68, 68, 0.3);
            z-index: 100;
        }

        .review-counter:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: scale(1.05);
        }

        .review-counter.empty {
            display: none;
        }

        /* Streak indicator */
        .streak-indicator {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(251, 191, 36, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            color: #fbbf24;
            opacity: 0;
            transition: all 0.3s;
            border: 1px solid rgba(251, 191, 36, 0.3);
            z-index: 100;
        }

        .streak-indicator.show {
            opacity: 1;
        }

        .streak-indicator.hot {
            background: rgba(251, 191, 36, 0.4);
            animation: pulse 0.5s ease-in-out infinite alternate;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        /* Mobile adjustments */
        @media (max-width: 500px) {
            .quality-control {
                top: auto;
                bottom: 60px;
                left: 10px;
                padding: 10px 12px;
            }

            .quality-slider {
                width: 80px;
            }

            .fullscreen-hint {
                display: none;
            }

            .slot-lights {
                gap: 10px;
            }

            .slot-light {
                width: 14px;
                height: 14px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }

        .slot-machine {
            background: linear-gradient(180deg, #2d2d4d 0%, #1a1a3a 50%, #151530 100%);
            border-radius: 25px;
            padding: clamp(20px, 5vw, 40px);
            box-shadow:
                0 0 0 3px #ffd93d,
                0 0 20px rgba(255, 217, 61, 0.3),
                0 10px 40px rgba(0, 0, 0, 0.6),
                inset 0 2px 0 rgba(255, 255, 255, 0.15),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            transition: transform 0.3s;
            max-width: 95vw;
        }

        .slot-machine::before {
            content: 'PULL TO INSULT';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(180deg, #ffd93d, #f39c12);
            color: #000;
            padding: 4px 20px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            letter-spacing: 2px;
            box-shadow: 0 2px 10px rgba(255, 217, 61, 0.5);
        }

        .slot-machine.shake {
            animation: bigShake 0.5s ease-out;
        }

        .wheels-container {
            display: flex;
            gap: clamp(10px, 3vw, 20px);
            margin-bottom: 25px;
            margin-top: 10px;
        }

        .wheel {
            width: clamp(130px, 30vw, 200px);
            height: clamp(90px, 15vw, 120px);
            background: linear-gradient(180deg, #0a0a15 0%, #111122 50%, #0a0a15 100%);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 3px solid #333;
            box-shadow:
                inset 0 0 30px rgba(0, 0, 0, 0.9),
                inset 0 0 60px rgba(0, 0, 0, 0.5),
                0 0 10px rgba(0, 0, 0, 0.5);
        }

        .wheel::before,
        .wheel::after {
            height: 35px;
            background: linear-gradient(to bottom, #0a0a15, transparent);
        }

        .wheel::after {
            background: linear-gradient(to top, #0a0a15, transparent);
        }

        .wheel::before,
        .wheel::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 30px;
            z-index: 10;
            pointer-events: none;
        }

        .wheel::before {
            top: 0;
            background: linear-gradient(to bottom, #111, transparent);
        }

        .wheel::after {
            bottom: 0;
            background: linear-gradient(to top, #111, transparent);
        }

        .wheel-inner {
            position: absolute;
            width: 100%;
            transition: transform 0.1s ease-out;
        }

        .wheel-item {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .wheel-item.left {
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5), 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .wheel-item.right {
            color: #4ecdc4;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5), 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .spin-btn {
            width: 100%;
            padding: clamp(15px, 4vw, 20px) clamp(20px, 5vw, 40px);
            font-family: 'Bangers', cursive;
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            letter-spacing: 4px;
            color: white;
            background: linear-gradient(180deg, #ff416c 0%, #ff4b2b 50%, #c0392b 100%);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow:
                0 0 0 3px rgba(255, 75, 43, 0.3),
                0 6px 0 #922b21,
                0 8px 20px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.1s ease;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .spin-btn:hover {
            background: linear-gradient(180deg, #ff5e7a 0%, #ff6347 50%, #e74c3c 100%);
            box-shadow:
                0 0 20px rgba(255, 75, 43, 0.5),
                0 6px 0 #922b21,
                0 8px 20px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
        }

        .spin-btn:active {
            transform: translateY(4px);
            box-shadow:
                0 0 10px rgba(255, 75, 43, 0.5),
                0 2px 0 #922b21,
                0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .spin-btn:disabled {
            background: linear-gradient(180deg, #555 0%, #444 100%);
            box-shadow: 0 4px 0 #333;
            cursor: not-allowed;
            color: #999;
        }

        .result {
            margin-top: 25px;
            text-align: center;
            min-height: 120px;
            padding: 0 10px;
        }

        .combo-display {
            font-family: 'Bangers', cursive;
            font-size: clamp(1.5rem, 7vw, 2.8rem);
            letter-spacing: 2px;
            margin-bottom: 15px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .combo-display.show {
            opacity: 1;
            transform: scale(1);
        }

        .combo-display .left-word {
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.7), 0 0 40px rgba(255, 107, 107, 0.4);
        }

        .combo-display .right-word {
            color: #4ecdc4;
            text-shadow: 0 0 20px rgba(78, 205, 196, 0.7), 0 0 40px rgba(78, 205, 196, 0.4);
        }

        .scores {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 15px;
            opacity: 0;
            transition: opacity 0.3s ease 0.2s;
        }

        .scores.show {
            opacity: 1;
        }

        .score-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .score-funny {
            background: #9b59b6;
        }

        .score-burn {
            background: #e67e22;
        }

        .vote-arrows {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .vote-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 0.6rem;
            width: 18px;
            height: 14px;
            border-radius: 3px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: all 0.1s;
        }

        .vote-btn:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.2);
        }

        .vote-btn:active {
            transform: scale(0.9);
        }

        .tier-badge {
            display: inline-block;
            padding: 10px 30px;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease 0.4s;
        }

        .tier-badge.show {
            opacity: 1;
            transform: translateY(0);
        }

        .tier-S {
            background: linear-gradient(135deg, #ffd700, #ffaa00, #ff8c00);
            color: #000;
            box-shadow:
                0 0 30px rgba(255, 215, 0, 0.7),
                0 0 60px rgba(255, 170, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.4);
            animation: tierGlow 0.5s ease-in-out infinite alternate;
            font-weight: bold;
        }

        .tier-A {
            background: linear-gradient(135deg, #a855f7, #9333ea, #7c3aed);
            box-shadow:
                0 0 25px rgba(168, 85, 247, 0.6),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
        }

        .tier-B {
            background: linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8);
            box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.2);
        }

        .tier-C {
            background: linear-gradient(135deg, #6b7280, #4b5563, #374151);
            box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.1);
        }

        /* Camera button */
        .camera-btn {
            display: none;
            margin-top: 15px;
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 40px);
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            font-weight: bold;
            color: white;
            background: linear-gradient(180deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow:
                0 4px 0 #047857,
                0 6px 15px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(16, 185, 129, 0.3);
            transition: all 0.2s;
            animation: pulseCamera 2s ease-in-out infinite;
        }

        .camera-btn.show {
            display: inline-block;
        }

        .camera-btn:hover {
            background: linear-gradient(180deg, #34d399 0%, #10b981 100%);
            transform: scale(1.05);
        }

        .camera-btn:active {
            transform: translateY(3px) scale(1.02);
            box-shadow:
                0 1px 0 #047857,
                0 3px 8px rgba(0, 0, 0, 0.3);
        }

        @keyframes pulseCamera {
            0%, 100% { box-shadow: 0 4px 0 #047857, 0 6px 15px rgba(0, 0, 0, 0.3), 0 0 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 4px 0 #047857, 0 6px 15px rgba(0, 0, 0, 0.3), 0 0 35px rgba(16, 185, 129, 0.6); }
        }

        .history {
            margin-top: 30px;
            width: 100%;
            max-width: 500px;
            padding: 0 10px;
        }

        .history h3 {
            color: #4ecdc4;
            margin-bottom: 12px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .history-item.tier-S {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .history-item.tier-A {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.3);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bigShake {
            0%, 100% { transform: translateX(0) rotate(0); }
            10% { transform: translateX(-10px) rotate(-1deg); }
            20% { transform: translateX(10px) rotate(1deg); }
            30% { transform: translateX(-10px) rotate(-1deg); }
            40% { transform: translateX(10px) rotate(1deg); }
            50% { transform: translateX(-5px) rotate(-0.5deg); }
            60% { transform: translateX(5px) rotate(0.5deg); }
            70% { transform: translateX(-3px) rotate(0); }
            80% { transform: translateX(3px) rotate(0); }
            90% { transform: translateX(-1px) rotate(0); }
        }

        @keyframes tierGlow {
            from { box-shadow: 0 0 30px rgba(241, 196, 15, 0.5); }
            to { box-shadow: 0 0 50px rgba(241, 196, 15, 0.8), 0 0 80px rgba(241, 196, 15, 0.4); }
        }

        .spinning {
            animation: shake 0.1s infinite;
        }

        /* Flash overlay for S-tier */
        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }

        .flash-overlay.flash {
            animation: flashAnim 0.5s ease-out;
        }

        @keyframes flashAnim {
            0% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }

        /* Lights on slot machine */
        .slot-lights {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }

        .slot-light {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #333;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
            transition: all 0.1s;
        }

        .slot-light.on {
            background: #f1c40f;
            box-shadow: 0 0 15px #f1c40f, inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .slot-light.red.on {
            background: #e74c3c;
            box-shadow: 0 0 15px #e74c3c, inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .slot-light.green.on {
            background: #2ecc71;
            box-shadow: 0 0 15px #2ecc71, inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        /* S-tier winner banner */
        .winner-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #000;
            padding: 30px 60px;
            border-radius: 20px;
            font-size: 3rem;
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            pointer-events: none;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.3);
            box-shadow: 0 10px 50px rgba(241, 196, 15, 0.8);
        }

        .winner-banner.show {
            animation: winnerPop 1.5s ease-out forwards;
        }

        @keyframes winnerPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            40% { transform: translate(-50%, -50%) scale(0.95); opacity: 1; }
            60% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="fullscreen-hint" onclick="toggleFullscreen()">Press F11 for fullscreen</div>
    <div class="flash-overlay" id="flashOverlay"></div>
    <div class="confetti-container" id="confettiContainer"></div>
    <div class="winner-banner" id="winnerBanner">JACKPOT!</div>

    <div class="quality-control">
        <label>Quality Bias</label>
        <input type="range" class="quality-slider" id="qualitySlider" min="0" max="100" value="50">
        <div class="quality-value" id="qualityValue">Mixed</div>
    </div>

    <div class="review-counter empty" id="reviewCounter" onclick="exportReviewList()">
        üóëÔ∏è <span id="reviewCount">0</span> flagged for review
    </div>

    <div class="streak-indicator" id="streakIndicator">
        üî• <span id="streakCount">0</span>/5 rapid spins!
    </div>

    <h1>POTTY MOUTH</h1>
    <p class="subtitle">The Insult Slot Machine</p>

    <div class="slot-machine" id="slotMachine">
        <div class="slot-lights">
            <div class="slot-light red" id="light1"></div>
            <div class="slot-light" id="light2"></div>
            <div class="slot-light green" id="light3"></div>
            <div class="slot-light" id="light4"></div>
            <div class="slot-light red" id="light5"></div>
        </div>
        <div class="wheels-container">
            <div class="wheel" id="leftWheel">
                <div class="wheel-inner" id="leftWheelInner"></div>
            </div>
            <div class="wheel" id="rightWheel">
                <div class="wheel-inner" id="rightWheelInner"></div>
            </div>
        </div>
        <button class="spin-btn" id="spinBtn">SPIN!</button>
    </div>

    <div class="result">
        <div class="combo-display" id="comboDisplay">
            <span class="left-word"></span> <span class="right-word"></span>
        </div>
        <div class="scores" id="scores">
            <span class="score-badge score-funny">
                Funny: <span id="funnyScore">-</span>
                <span class="vote-arrows">
                    <button class="vote-btn" onclick="voteScore('funny', 1)">‚ñ≤</button>
                    <button class="vote-btn" onclick="voteScore('funny', -1)">‚ñº</button>
                </span>
            </span>
            <span class="score-badge score-burn">
                Burn: <span id="burnScore">-</span>
                <span class="vote-arrows">
                    <button class="vote-btn" onclick="voteScore('burn', 1)">‚ñ≤</button>
                    <button class="vote-btn" onclick="voteScore('burn', -1)">‚ñº</button>
                </span>
            </span>
        </div>
        <div class="tier-badge" id="tierBadge"></div>
        <button class="camera-btn" id="cameraBtn">SNAP & SEND</button>
        <button class="trash-btn" id="trashBtn" title="Flag for review">üóëÔ∏è</button>
    </div>

    <div class="history">
        <h3>Recent Burns</h3>
        <div class="history-list" id="historyList"></div>
    </div>

    <script>
        // Sound files
        const sounds = {
            farts: ['sounds/fart1.mp3', 'sounds/fart2.mp3', 'sounds/fart3.mp3'],
            burps: ['sounds/burp1.mp3', 'sounds/burp2.mp3', 'sounds/burp3.mp3'],
            ding: 'sounds/ding.mp3',
            bell: 'sounds/bell.mp3',
            slotMachine: 'sounds/slot_machine.mp3',
            crowdCheer: 'sounds/crowd_cheer.mp3',
            applause: 'sounds/applause.mp3'
        };

        // Preload sounds
        const audioCache = {};
        function preloadSounds() {
            [...sounds.farts, ...sounds.burps, sounds.ding, sounds.bell,
             sounds.slotMachine, sounds.crowdCheer, sounds.applause].forEach(src => {
                const audio = new Audio(src);
                audio.preload = 'auto';
                audioCache[src] = audio;
            });
        }
        preloadSounds();

        function playSound(src, volume = 1.0) {
            const audio = new Audio(src);
            audio.volume = volume;
            audio.play().catch(() => {}); // Ignore autoplay errors
        }

        function playRandomFart() {
            const src = sounds.farts[Math.floor(Math.random() * sounds.farts.length)];
            playSound(src, 0.5);
        }

        function playRandomBurp() {
            const src = sounds.burps[Math.floor(Math.random() * sounds.burps.length)];
            playSound(src, 0.5);
        }

        function playDing() {
            playSound(sounds.ding, 0.3);
        }

        function playBell() {
            playSound(sounds.bell, 0.4);
        }

        // Sound rotation tracking
        let tickCount = 0;
        let lastWackyTime = 0;
        const WACKY_COOLDOWN = 800; // ms between wacky sounds

        function playSpinTick() {
            tickCount++;
            const now = Date.now();

            // Every 12-18 ticks, play a wacky sound (with cooldown)
            if (tickCount % (12 + Math.floor(Math.random() * 7)) === 0 &&
                now - lastWackyTime > WACKY_COOLDOWN) {
                lastWackyTime = now;
                const wackySounds = [playRandomFart, playRandomBurp, playDing];
                wackySounds[Math.floor(Math.random() * wackySounds.length)]();
                return;
            }

            // Normal tick - simple beep using Web Audio
            if (!window.tickAudioCtx) {
                window.tickAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            const ctx = window.tickAudioCtx;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.type = 'sine';
            osc.frequency.setValueAtTime(800 + Math.random() * 400, ctx.currentTime);
            gain.gain.setValueAtTime(0.03, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.02);

            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.02);
        }

        function playLeverPull() {
            // Play slot machine start sound (just the beginning)
            const audio = new Audio(sounds.slotMachine);
            audio.volume = 0.3;
            audio.play().catch(() => {});
            // Stop after 0.5s
            setTimeout(() => {
                audio.pause();
            }, 500);
        }

        function playWheelStop() {
            playDing();
        }

        function playJackpot() {
            // Play crowd cheer for S-tier!
            playSound(sounds.crowdCheer, 0.7);
            // Add applause on top with slight delay
            setTimeout(() => {
                playSound(sounds.applause, 0.5);
            }, 500);
            // Bell for extra celebration
            setTimeout(() => {
                playBell();
            }, 300);
        }

        function playNormalWin() {
            playDing();
        }

        // Confetti
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#ff6b6b', '#4ecdc4'];

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = (Math.random() * 10 + 5) + 'px';
                confetti.style.height = (Math.random() * 10 + 5) + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.animation = `confettiFall ${Math.random() * 2 + 2}s ease-out forwards`;
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                container.appendChild(confetti);
            }

            setTimeout(() => {
                container.innerHTML = '';
            }, 4000);
        }

        // Lights animation
        let lightInterval = null;

        function startLights() {
            const lights = document.querySelectorAll('.slot-light');
            let index = 0;
            lightInterval = setInterval(() => {
                lights.forEach(l => l.classList.remove('on'));
                lights[index % lights.length].classList.add('on');
                lights[(index + 2) % lights.length].classList.add('on');
                index++;
            }, 100);
        }

        function stopLights(allOn = false) {
            clearInterval(lightInterval);
            const lights = document.querySelectorAll('.slot-light');
            if (allOn) {
                lights.forEach(l => l.classList.add('on'));
            } else {
                lights.forEach(l => l.classList.remove('on'));
            }
        }

        function celebrateSTier() {
            // Flash
            const flash = document.getElementById('flashOverlay');
            flash.classList.add('flash');
            setTimeout(() => flash.classList.remove('flash'), 500);

            // Shake
            const machine = document.getElementById('slotMachine');
            machine.classList.add('shake');
            setTimeout(() => machine.classList.remove('shake'), 500);

            // Winner banner
            const banner = document.getElementById('winnerBanner');
            banner.classList.add('show');
            setTimeout(() => banner.classList.remove('show'), 1500);

            // Confetti
            createConfetti();

            // Lights all on
            stopLights(true);

            // Sound
            playJackpot();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        let wordData = null;
        let isSpinning = false;
        let history = [];
        let tickInterval = null;
        let currentCombo = null;

        // Review list (persisted to localStorage)
        let reviewList = JSON.parse(localStorage.getItem('pottyMouthReview') || '[]');
        updateReviewCounter();

        // Rapid spin tracking
        let spinTimestamps = [];
        const RAPID_SPIN_COUNT = 5;
        const RAPID_SPIN_WINDOW = 10000; // 10 seconds
        let forceSTier = false;

        // Combo pools by tier (built after data loads)
        let combosByTier = { S: [], A: [], B: [], C: [] };

        function updateReviewCounter() {
            const counter = document.getElementById('reviewCounter');
            const count = document.getElementById('reviewCount');
            count.textContent = reviewList.length;
            counter.classList.toggle('empty', reviewList.length === 0);
        }

        function exportReviewList() {
            if (reviewList.length === 0) {
                alert('No combos flagged for review yet!');
                return;
            }
            const csv = 'Combo,Funny,Burn,Tier\n' + reviewList.map(r =>
                `"${r.combo}",${r.funny},${r.burn},${r.tier}`
            ).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'potty_mouth_review.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function checkRapidSpins() {
            const now = Date.now();
            spinTimestamps.push(now);

            // Remove old timestamps
            spinTimestamps = spinTimestamps.filter(t => now - t < RAPID_SPIN_WINDOW);

            const indicator = document.getElementById('streakIndicator');
            const countEl = document.getElementById('streakCount');

            if (spinTimestamps.length >= 2) {
                countEl.textContent = spinTimestamps.length;
                indicator.classList.add('show');
                indicator.classList.toggle('hot', spinTimestamps.length >= RAPID_SPIN_COUNT - 1);

                if (spinTimestamps.length >= RAPID_SPIN_COUNT) {
                    forceSTier = true;
                    spinTimestamps = []; // Reset after triggering
                }
            } else {
                indicator.classList.remove('show', 'hot');
            }
        }

        function getQualityBias() {
            const slider = document.getElementById('qualitySlider');
            return parseInt(slider.value);
        }

        function updateQualityLabel() {
            const value = getQualityBias();
            const label = document.getElementById('qualityValue');
            if (value < 20) label.textContent = 'All (Raw)';
            else if (value < 40) label.textContent = 'Mixed';
            else if (value < 60) label.textContent = 'Good';
            else if (value < 80) label.textContent = 'Great';
            else label.textContent = 'Fire üî•';
        }

        document.getElementById('qualitySlider').addEventListener('input', updateQualityLabel);

        function voteScore(type, delta) {
            if (!currentCombo) return;

            if (type === 'funny') {
                currentCombo.funny = Math.max(1, Math.min(10, currentCombo.funny + delta));
                document.getElementById('funnyScore').textContent = currentCombo.funny;
            } else {
                currentCombo.burn = Math.max(1, Math.min(10, currentCombo.burn + delta));
                document.getElementById('burnScore').textContent = currentCombo.burn;
            }

            // Update in review list if present
            const idx = reviewList.findIndex(r => r.combo === currentCombo.combo);
            if (idx >= 0) {
                reviewList[idx] = { ...currentCombo };
                localStorage.setItem('pottyMouthReview', JSON.stringify(reviewList));
            }

            // Play a little click
            playVoteClick();
        }

        function playVoteClick() {
            if (!window.tickAudioCtx) {
                window.tickAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            const ctx = window.tickAudioCtx;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(1200, ctx.currentTime);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.05);
        }

        // Load word data
        fetch('words.json')
            .then(res => res.json())
            .then(data => {
                wordData = data;
                console.log(`Loaded ${data.leftWords.length} left words, ${data.rightWords.length} right words`);

                // Build combo pools by tier
                Object.entries(data.combos).forEach(([key, score]) => {
                    const [left, right] = key.split('|');
                    combosByTier[score.tier].push({ left, right, ...score });
                });
                console.log(`Combos by tier: S=${combosByTier.S.length}, A=${combosByTier.A.length}, B=${combosByTier.B.length}, C=${combosByTier.C.length}`);

                initWheels();
            });

        function initWheels() {
            const leftInner = document.getElementById('leftWheelInner');
            const rightInner = document.getElementById('rightWheelInner');

            // Create wheel items
            wordData.leftWords.forEach(word => {
                const item = document.createElement('div');
                item.className = 'wheel-item left';
                item.textContent = word;
                leftInner.appendChild(item);
            });

            wordData.rightWords.forEach(word => {
                const item = document.createElement('div');
                item.className = 'wheel-item right';
                item.textContent = word;
                rightInner.appendChild(item);
            });
        }

        function getRandomWord(words) {
            return words[Math.floor(Math.random() * words.length)];
        }

        function getComboScore(left, right) {
            const key = `${left}|${right}`;
            return wordData.combos[key] || { funny: 5, burn: 5, tier: 'C' };
        }

        function spinWheel(wheelInner, words, targetWord, duration) {
            return new Promise(resolve => {
                const itemHeight = 120;
                const targetIndex = words.indexOf(targetWord);
                const totalItems = words.length;

                // Spin through multiple rotations plus land on target
                const rotations = 3 + Math.random() * 2;
                const totalDistance = (rotations * totalItems + targetIndex) * itemHeight;

                let startTime = null;
                let lastTickPos = 0;

                const animate = (timestamp) => {
                    if (!startTime) startTime = timestamp;
                    const progress = (timestamp - startTime) / duration;

                    if (progress < 1) {
                        // Easing function (ease out cubic)
                        const eased = 1 - Math.pow(1 - progress, 3);
                        const currentPos = totalDistance * eased;

                        // Play tick sound every item
                        const currentItem = Math.floor(currentPos / itemHeight);
                        if (currentItem !== lastTickPos) {
                            playSpinTick();
                            lastTickPos = currentItem;
                        }

                        wheelInner.style.transform = `translateY(-${currentPos % (totalItems * itemHeight)}px)`;
                        requestAnimationFrame(animate);
                    } else {
                        wheelInner.style.transform = `translateY(-${targetIndex * itemHeight}px)`;
                        playWheelStop();
                        resolve();
                    }
                };

                requestAnimationFrame(animate);
            });
        }

        async function spin() {
            if (isSpinning || !wordData) return;

            isSpinning = true;
            const spinBtn = document.getElementById('spinBtn');
            const leftWheel = document.getElementById('leftWheel');
            const rightWheel = document.getElementById('rightWheel');
            const cameraBtn = document.getElementById('cameraBtn');

            // Play lever sound
            playLeverPull();

            spinBtn.disabled = true;
            spinBtn.textContent = 'SPINNING...';
            leftWheel.classList.add('spinning');
            rightWheel.classList.add('spinning');
            cameraBtn.classList.remove('show');

            // Start lights
            startLights();

            // Hide previous result
            document.getElementById('comboDisplay').classList.remove('show');
            document.getElementById('scores').classList.remove('show');
            document.getElementById('tierBadge').classList.remove('show');

            // Check rapid spins
            checkRapidSpins();

            // Pick combo based on quality bias (or force S-tier)
            let leftWord, rightWord;

            if (forceSTier && combosByTier.S.length > 0) {
                // Forced S-tier from rapid spinning!
                const combo = combosByTier.S[Math.floor(Math.random() * combosByTier.S.length)];
                leftWord = combo.left;
                rightWord = combo.right;
                forceSTier = false;
                document.getElementById('streakIndicator').classList.remove('show', 'hot');
            } else {
                // Quality-biased selection
                const bias = getQualityBias();
                let pool = [];

                if (bias < 20) {
                    // All combos
                    pool = [...combosByTier.S, ...combosByTier.A, ...combosByTier.B, ...combosByTier.C];
                } else if (bias < 40) {
                    // Weighted toward better (S*4, A*3, B*2, C*1)
                    pool = [
                        ...combosByTier.S, ...combosByTier.S, ...combosByTier.S, ...combosByTier.S,
                        ...combosByTier.A, ...combosByTier.A, ...combosByTier.A,
                        ...combosByTier.B, ...combosByTier.B,
                        ...combosByTier.C
                    ];
                } else if (bias < 60) {
                    // Good: S, A, B only
                    pool = [...combosByTier.S, ...combosByTier.A, ...combosByTier.B];
                } else if (bias < 80) {
                    // Great: S and A only, weighted toward S
                    pool = [
                        ...combosByTier.S, ...combosByTier.S, ...combosByTier.S,
                        ...combosByTier.A
                    ];
                } else {
                    // Fire: S-tier only
                    pool = combosByTier.S;
                }

                const combo = pool[Math.floor(Math.random() * pool.length)];
                leftWord = combo.left;
                rightWord = combo.right;
            }

            // Spin both wheels
            await Promise.all([
                spinWheel(document.getElementById('leftWheelInner'), wordData.leftWords, leftWord, 2000),
                spinWheel(document.getElementById('rightWheelInner'), wordData.rightWords, rightWord, 2500)
            ]);

            leftWheel.classList.remove('spinning');
            rightWheel.classList.remove('spinning');

            // Get score
            const score = getComboScore(leftWord, rightWord);

            // Display result
            const comboDisplay = document.getElementById('comboDisplay');
            comboDisplay.querySelector('.left-word').textContent = leftWord;
            comboDisplay.querySelector('.right-word').textContent = rightWord;
            comboDisplay.classList.add('show');

            document.getElementById('funnyScore').textContent = score.funny;
            document.getElementById('burnScore').textContent = score.burn;
            document.getElementById('scores').classList.add('show');

            const tierBadge = document.getElementById('tierBadge');
            tierBadge.textContent = `${score.tier}-TIER`;
            tierBadge.className = `tier-badge tier-${score.tier} show`;

            // Store current combo for trash button
            currentCombo = {
                combo: `${leftWord} ${rightWord}`,
                left: leftWord,
                right: rightWord,
                funny: score.funny,
                burn: score.burn,
                tier: score.tier
            };

            // Celebration for S-tier
            if (score.tier === 'S') {
                celebrateSTier();
            } else {
                stopLights();
                playNormalWin();
            }

            // Show camera and trash buttons
            cameraBtn.classList.add('show');
            const trashBtn = document.getElementById('trashBtn');
            trashBtn.classList.add('show');
            trashBtn.classList.remove('trashed');
            // Check if already in review list
            if (reviewList.some(r => r.combo === currentCombo.combo)) {
                trashBtn.classList.add('trashed');
            }

            // Add to history
            addToHistory(leftWord, rightWord, score.tier);

            spinBtn.disabled = false;
            spinBtn.textContent = 'SPIN!';
            isSpinning = false;
        }

        function addToHistory(left, right, tier) {
            const combo = `${left} ${right}`;

            // Don't add duplicates
            if (history.some(h => h.combo === combo)) return;

            history.unshift({ combo, tier });
            if (history.length > 10) history.pop();

            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            history.forEach(item => {
                const el = document.createElement('span');
                el.className = `history-item tier-${item.tier}`;
                el.textContent = item.combo;
                historyList.appendChild(el);
            });
        }

        // Camera button handler (mock for demo)
        document.getElementById('cameraBtn').addEventListener('click', () => {
            alert('üì∏ Camera UI Coming Soon!\n\nIn the full version:\n‚Ä¢ Take a photo of your friend\n‚Ä¢ Overlay the insult\n‚Ä¢ Send via text or email\n‚Ä¢ Post to social media');
        });

        // Trash button handler
        document.getElementById('trashBtn').addEventListener('click', () => {
            if (!currentCombo) return;

            const trashBtn = document.getElementById('trashBtn');

            // Check if already in list
            const existingIndex = reviewList.findIndex(r => r.combo === currentCombo.combo);
            if (existingIndex >= 0) {
                // Remove from review list (toggle off)
                reviewList.splice(existingIndex, 1);
                trashBtn.classList.remove('trashed');
            } else {
                // Add to review list
                reviewList.push(currentCombo);
                trashBtn.classList.add('trashed');
            }

            localStorage.setItem('pottyMouthReview', JSON.stringify(reviewList));
            updateReviewCounter();
        });

        document.getElementById('spinBtn').addEventListener('click', spin);

        // Spacebar to spin
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                spin();
            }
            if (e.code === 'KeyF') {
                toggleFullscreen();
            }
        });

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
